{% extends 'layout.html' %}

{% block title %}Book Details - Eldergate Library{% endblock %}

{% block content %}

{% include 'includes/header.html' %}

<div class="flex-1 p-8 overflow-y-auto">
    <div
        class="bg-card-light dark:bg-card-dark p-8 rounded-xl border border-border-light dark:border-border-dark">
        <div class="flex flex-col lg:flex-row gap-8">
            <div class="lg:w-1/3 flex-shrink-0">
                <img alt="Book cover for The Lovely Bones"
                    class="w-full h-auto object-cover rounded-lg shadow-lg"
                    src="{{ book_data.cover }}" />
            </div>
            <div class="lg:w-2/3">
                <h1 class="text-4xl font-bold text-text-light dark:text-text-dark mb-2">{{ book_data.title }}</h1>
                <p class="text-xl text-subtext-light dark:text-subtext-dark mb-4">by {{ book_data.author }}</p>
                <div class="flex items-center gap-2 mb-6">
                    <span
                        class="text-xs font-semibold text-yellow-500 bg-yellow-500/10 py-1 px-3 rounded-full">{{ book_data.category }}</span>
                    <span
                        class="text-xs font-semibold text-blue-500 bg-blue-500/10 py-1 px-3 rounded-full">{{ book_data.subcategory }}</span>
                </div>
                <p class="text-text-light dark:text-text-dark leading-relaxed mb-6">
                    {{ book_data.description }}
                </p>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-6 mb-8">
                    <div>
                        <p class="text-sm text-subtext-light dark:text-subtext-dark">ISBN</p>
                        <p class="font-semibold text-text-light dark:text-text-dark">{{ book_data.isbn }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-subtext-light dark:text-subtext-dark">Publisher</p>
                        <p class="font-semibold text-text-light dark:text-text-dark">{{ book_data.publisher }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-subtext-light dark:text-subtext-dark">Publication Date</p>
                        <p class="font-semibold text-text-light dark:text-text-dark">{{ book_data.publication_date }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-subtext-light dark:text-subtext-dark">Category</p>
                        <p class="font-semibold text-text-light dark:text-text-dark">{{ book_data.category }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-subtext-light dark:text-subtext-dark">Total Pages</p>
                        <p class="font-semibold text-text-light dark:text-text-dark">{{ book_data.pages }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-subtext-light dark:text-subtext-dark">Price</p>
                        <p class="font-semibold text-text-light dark:text-text-dark">{{ book_data.price }}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button
                        class="bg-primary text-white py-3 px-6 rounded-lg font-semibold flex items-center justify-center hover:bg-primary/90 transition-colors" data-action-btn data-action-text="{{ book_data.action_btn.text }}" data-book-id="{{ book_data.id }}">
                        <span class="material-icons mr-2">{{ book_data.action_btn.icon }}</span>
                        {{ book_data.action_btn.text }}
                    </button>
                    <button
                        class="border border-primary text-primary py-3 px-6 rounded-lg font-semibold flex items-center justify-center hover:bg-primary/10 transition-colors">
                        <span class="material-icons mr-2">favorite_border</span>
                        Add to Wishlist
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const actionBtn = document.querySelector('[data-action-btn]');
    const actionText = document.querySelector('[data-action-text]').getAttribute('data-action-text');
    const bookId = document.querySelector('[data-book-id]').getAttribute('data-book-id');
    const readBookEndpointTemplate = "{% url 'read-book' 0 %}?book_type=dtype";

    actionBtn.addEventListener('click', function() {
        if (actionText === 'Read now') {
            actionBtn.textContent = 'Processing...';

            const readBookEndpoint = readBookEndpointTemplate.replace('0', bookId).replace('dtype', 'free');

            fetch(readBookEndpoint)
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Book added to your library successfully!') {
                    actionBtn.textContent = 'Added to Library';
                    window.location.href = data.open_book_url;
                }
                else {
                    NotifyX.warning(data.error, { duration: 3000, dismissible: true, theme: 'dark' });
                }
            })
            
        } else {
            actionBtn.textContent = 'Added to Cart';
        }
    });
</script>

{% endblock %}
