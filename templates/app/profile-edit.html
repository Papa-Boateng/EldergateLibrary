{% extends base_layout %}


{% block title %}Dashboard - Eldergate Library{% endblock %}

{% block content %}
{% include 'includes/header.html' %}
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
    <div class="layout-container flex h-full grow flex-col">
        <div class="px-40 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col max-w-[960px] flex-1">

                <div class="flex p-4 border-b border-solid border-b-[#233648] pb-8">
                    <div
                        class="flex w-full flex-row gap-4 justify-between items-center">
                        <div class="flex gap-4 items-center">
                            <div class="relative group">
                                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-32 w-32"
                                    data-alt="User profile picture"
                                    style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCwElo1aDKaMTywOzfHaQQkGArbnxNkXjq6CmRYOn4vPh6CJuNGlMY3ODVpwc2x01uHyBTIa-WcET0vWAAxOriwBO8WR6FaA-mGznoY33deQDG7MGA-_bg-Gh9jAM6hTUE0QOzMQrIY_Y9r0YtO6vXc0cs0BomrIaXt5d-WUXx177R3qzEGYzaApZ71PFRPs5SVbYGHB1nCXF9duZnks2kmINAzLKrVyQPFq09AWd3QUkM3TWD5p0nT8Lz_Ju-JhDbYDTAwXchOeXSa");'>
                                </div>
                                <div
                                    class="absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <span class="material-symbols-outlined text-white text-4xl">upload</span>
                                </div>
                            </div>
                            <div class="flex flex-col justify-center">
                                <p class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">
                                    {{ user.First_Name }} {{ user.Last_Name }}</p>
                                <p class="text-[#92adc9] text-base font-normal leading-normal">
                                    {{ user.email }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <form method="post" class="flex flex-col gap-6 px-4" action="{% url 'profile-edit' %}" enctype="multipart/form-data" id="profile-edit-form">
                    {% csrf_token %}
                    <div class="flex flex-col sm:flex-row gap-6">
                        <div class="flex max-w-[480px] flex-wrap items-end gap-4 py-3 flex-1">
                            <label class="flex flex-col min-w-40 flex-1">
                                <p class="text-white text-base font-medium leading-normal pb-2">First Name</p>
                                <input
                                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary border border-[#324d67] bg-[#192633] focus:border-[#324d67] h-14 placeholder:text-[#92adc9] p-[15px] text-base font-normal leading-normal"
                                    value="{{ user.First_Name }}" name="profile-first-name" id="profile-first-name"/>
                            </label>
                        </div>
                        <div class="flex max-w-[480px] flex-wrap items-end gap-4 py-3 flex-1">
                            <label class="flex flex-col min-w-40 flex-1">
                                <p class="text-white text-base font-medium leading-normal pb-2">Last Name</p>
                                <input
                                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary border border-[#324d67] bg-[#192633] focus:border-[#324d67] h-14 placeholder:text-[#92adc9] p-[15px] text-base font-normal leading-normal"
                                    value="{{ user.Last_Name }}" name="profile-last-name" id="profile-last-name" />
                            </label>
                        </div>
                    </div>
                    <div class="flex max-w-full flex-wrap items-end gap-4 py-3">
                        <label class="flex flex-col min-w-40 flex-1">
                            <p class="text-white text-base font-medium leading-normal pb-2">Username</p>
                            <input
                                class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary border border-[#324d67] bg-[#192633] focus:border-[#324d67] h-14 placeholder:text-[#92adc9] p-[15px] text-base font-normal leading-normal"
                                value="{{ user.username }}" disabled="disabled"/>
                        </label>
                    </div>
                    
                    <div class="flex max-w-full flex-wrap items-end gap-4 py-3">
                        <label class="flex flex-col min-w-40 flex-1">
                            <p class="text-white text-base font-medium leading-normal pb-2">Email</p>
                            <input
                                class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary border border-[#324d67] bg-[#192633] focus:border-[#324d67] h-14 placeholder:text-[#92adc9] p-[15px] text-base font-normal leading-normal"
                                type="email" value="{{ user.email }}" name="profile-email" id="profile-email" />
                        </label>
                    </div>
                    <div class="flex justify-end gap-4 mt-6">
                        <button type="submit"
                            class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em]">
                            <span class="truncate">Save Changes</span>
                        </button>
                    </div>
                </form>
    
            </div>
        </div>
    </div>
</div>

<script>
    const profileEditForm = document.getElementById('profile-edit-form');

    if(profileEditForm) {
    profileEditForm.addEventListener('submit', function (event) {
      event.preventDefault();

      const form = event.target;
      const formData = new FormData(form);
      const url = form.action;

      fetch(url, {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
          'X-Requested-With': 'XMLHttpRequest',
        },
      })
      .then(response => response.json().then(data => ({ status: response.status, body: data })))
      .then(data => {
        if (data.status === 200) {
            NotifyX.success(data.body.message, { duration: 3000, dismissible: true, theme: 'dark' });
        } else if (data.status === 201) {
            NotifyX.info(data.body.message, { duration: 3000, dismissible: true, theme: 'dark' });
        } else {
            NotifyX.error(data.body.error, { duration: 3000, dismissible: true, theme: 'dark' });
        }
      })
      .catch(error => {
        NotifyX.error('An unexpected error occurred. Please try again.', { duration: 3000, dismissible: true, theme: 'dark' });
      });
    });
  }
</script>
{% endblock %}